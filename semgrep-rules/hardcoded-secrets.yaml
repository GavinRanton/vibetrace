rules:
  - id: hardcoded-secret-variable
    patterns:
      - pattern-either:
          - pattern: const $KEY = "..."
          - pattern: let $KEY = "..."
          - pattern: var $KEY = "..."
          - pattern: const $KEY = '...'
          - pattern: let $KEY = '...'
          - pattern: var $KEY = '...'
      - metavariable-regex:
          metavariable: $KEY
          regex: (?i).*(secret|password|passwd|api_key|apikey|access_key|private_key|jwt_secret|auth_token|db_pass|database_pass|token|credential|credentials).*
      - metavariable-regex:
          metavariable: $KEY
          regex: (?i)^(?!.*(_url|_host|_name|_type|_path|_prefix|_suffix|_label|_text|_message|_desc|_field)).*
    message: "Hardcoded secret or credential detected in variable '$KEY'. Move this to an environment variable."
    languages: [javascript, typescript]
    severity: ERROR
    metadata:
      category: security
      cwe: "CWE-798"
      owasp: "A07:2021 - Identification and Authentication Failures"

  - id: hardcoded-secret-object-property
    patterns:
      - pattern-either:
          - pattern: |
              {
                ...,
                $KEY: "...",
                ...
              }
          - pattern: |
              {
                ...,
                $KEY: '...',
                ...
              }
      - metavariable-regex:
          metavariable: $KEY
          regex: (?i).*(secret|password|passwd|api_key|apikey|private_key|jwt_secret|auth_token|token).*
    message: "Hardcoded secret in object property '$KEY'. Use environment variables instead."
    languages: [javascript, typescript]
    severity: ERROR
    metadata:
      category: security
      cwe: "CWE-798"

  - id: weak-random-for-security
    patterns:
      - pattern-either:
          - pattern: Math.random()
      - pattern-either:
          - pattern: $TOKEN = $EXPR
          - pattern: $SECRET = $EXPR
          - pattern: $KEY = $EXPR
          - pattern: $HASH = $EXPR
    message: "Math.random() is not cryptographically secure. Use crypto.randomBytes() or crypto.randomUUID() for security-sensitive values."
    languages: [javascript, typescript]
    severity: WARNING
    metadata:
      category: security
      cwe: "CWE-338"
      owasp: "A02:2021 - Cryptographic Failures"
